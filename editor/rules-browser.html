<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPQ Rules Manager</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; color: #333; }
    .header { background: #1976d2; color: white; padding: 16px 24px; display: flex; align-items: center; gap: 16px; }
    .header h1 { font-size: 1.4rem; font-weight: 400; }
    .container { max-width: 960px; margin: 24px auto; padding: 0 24px; }
    .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.12); margin-bottom: 16px; overflow: hidden; }
    .card-header { padding: 16px 20px; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; justify-content: space-between; }
    .card-header h2 { font-size: 1.1rem; font-weight: 500; }
    .card-body { padding: 20px; }
    .rule-list { list-style: none; }
    .rule-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
    .rule-item:last-child { border-bottom: none; }
    .rule-name { font-weight: 500; }
    .rule-path { font-size: 0.85rem; color: #757575; font-family: monospace; }
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.875rem; text-decoration: none; }
    .btn-primary { background: #1976d2; color: white; }
    .btn-outline { background: transparent; border: 1px solid #1976d2; color: #1976d2; }
    .btn:hover { opacity: 0.85; }
    .btn-group { display: flex; gap: 8px; }
    .editor-link { display: inline-block; margin-top: 8px; }
    .info { padding: 16px 20px; background: #e3f2fd; border-radius: 4px; margin-bottom: 16px; font-size: 0.9rem; line-height: 1.5; }
    .loading { text-align: center; padding: 40px; color: #757575; }
    #upload-input { display: none; }
  </style>
</head>
<body>
  <div class="header">
    <h1>CPQ Rules Manager</h1>
  </div>

  <div class="container">
    <div class="info">
      <strong>Hoe te gebruiken:</strong><br>
      1. Download een regelbestand hieronder<br>
      2. Open de <a href="/editor/" target="_blank">GoRules Editor</a> en laad het bestand via File &gt; Open<br>
      3. Bewerk de regel en sla op (File &gt; Save)<br>
      4. Upload het bijgewerkte bestand met de upload-knop
    </div>

    <div class="card">
      <div class="card-header">
        <h2>Rolluik Regels</h2>
      </div>
      <div class="card-body">
        <ul class="rule-list" id="rule-list">
          <li class="loading">Laden...</li>
        </ul>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h2>Editor</h2>
      </div>
      <div class="card-body">
        <p>Open de standalone GoRules Editor om regelbestanden te bewerken:</p>
        <a href="/editor/" target="_blank" class="btn btn-primary editor-link">Open GoRules Editor</a>
      </div>
    </div>
  </div>

  <input type="file" id="upload-input" accept=".json">

  <script>
    const RULES_BASE = '/rules/default/families/roller-shutter';
    const RULE_FILES = [
      { name: 'Validatie', file: 'validate.json', desc: 'Valideert configuratie-invoer (afmetingen, materiaal, etc.)' },
      { name: 'Beschikbare Opties', file: 'options.json', desc: 'Bepaalt beschikbare opties per parameter' },
      { name: 'Stuklijst (BOM)', file: 'bom.json', desc: 'Genereert de stuklijst op basis van configuratie' },
    ];

    function renderRules() {
      const list = document.getElementById('rule-list');
      list.innerHTML = RULE_FILES.map(rule => `
        <li class="rule-item">
          <div>
            <div class="rule-name">${rule.name}</div>
            <div class="rule-path">${rule.file}</div>
            <div style="font-size:0.85rem;color:#757575;margin-top:4px;">${rule.desc}</div>
          </div>
          <div class="btn-group">
            <a href="${RULES_BASE}/${rule.file}" download class="btn btn-primary">Download</a>
            <button class="btn btn-outline" onclick="uploadRule('${rule.file}')">Upload</button>
          </div>
        </li>
      `).join('');
    }

    function uploadRule(filename) {
      const input = document.getElementById('upload-input');
      input.onchange = async () => {
        const file = input.files[0];
        if (!file) return;
        try {
          const text = await file.text();
          JSON.parse(text); // validate JSON
          const resp = await fetch(`${RULES_BASE}/${filename}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: text
          });
          if (resp.ok) {
            alert(`${filename} succesvol geupload! De regelengine pikt wijzigingen automatisch op.`);
          } else {
            alert(`Upload mislukt: ${resp.status} ${resp.statusText}`);
          }
        } catch (e) {
          alert(`Fout: ${e.message}`);
        }
        input.value = '';
      };
      input.click();
    }

    renderRules();
  </script>
</body>
</html>
